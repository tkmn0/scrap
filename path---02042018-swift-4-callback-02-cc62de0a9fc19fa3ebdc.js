webpackJsonp([50161691120937],{384:function(n,s){n.exports={data:{site:{meta:{title:"n0の断片",description:"メモとか、スニペットとか",url:"https://tkmn0.github.io/scrap/",author:"n0",twitter:"n0",adsense:""}},post:{id:"/Users/kadinche/Desktop/n0WorkSpace/techblog/blog/src/pages/articles/Swfit4でコールバック(２)/index.md absPath of file >>> MarkdownRemark",html:'<ul>\n<li>クロージャによるコールバック</li>\n<li>Delegate を使ったコールバック</li>\n<li>IObserver を使ったコールバック</li>\n</ul>\n<p>今回は<code>Delegate</code>を使ったコールバックをゆるゆる紹介します。</p>\n  <!--more-->\n<h1>デリゲートとは</h1>\n<p>The Swift Programing Language によると</p>\n<blockquote>\n<p>Delegation is a design pattern that enables a class or structure to hand off(or delegate) some of its responsibilities to an instance of another type.    </p>\n</blockquote>\n<p>だそうで、デリゲートとは、</p>\n<ul>\n<li><code>デザインパンターンの一つ</code>である。</li>\n<li>delegate を用いれば、とあるクラスや構造体は、処理の一部を他の型のインスタンスに移譲することができます。   </li>\n</ul>\n<h3>デザインパターンとは</h3>\n<hr>\n<blockquote>\n<p>ソフトウェア開発におけるデザインパターン（型紙（かたがみ）または設計パターン、英: design pattern）とは、過去のソフトウェア設計者が発見し編み出した設計ノウハウを蓄積し、名前をつけ、再利用しやすいように特定の規約に従ってカタログ化したものである</p>\n</blockquote>\n<p><a href="https://ja.wikipedia.org/wiki/%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3_(%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2)">wikipediaより引用</a></p>\n<p>なんかよくわからないですね。\n同じ wiki 内の概要がわかりやすいかったです。</p>\n<blockquote>\n<p>コンピュータのプログラミングで、素人と達人の間では驚くほどの生産性の差があり、その差はかなりの部分が経験の違いからきている。達人は、さまざまな難局を、何度も何度も耐え忍んで乗り切ってきている。そのような達人たちが同じ問題に取り組んだ場合、典型的にはみな同じパターンの解決策に辿り着く。これがデザインパターンである (GoF)。</p>\n</blockquote>\n<p><code>問題解決のパターンを共有しようよ。そしたら設計の話し合いとかスムーズにいくよね</code><br>\nということですね。</p>\n<h3>処理を移譲してみる</h3>\n<hr>\n<p>実際にコードを書いて見ましょう。</p>\n<p>まず、色を外から指定する ColorView を作ります。<br>\n</p>\n<h4>UIの準備</h4>\n<p><code>ColorView.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ColorView</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token punctuation">{</span>\n\n    <span class="token keyword">enum</span> colors<span class="token punctuation">{</span>\n        <span class="token keyword">case</span> red\n        <span class="token keyword">case</span> blue\n        <span class="token keyword">case</span> yellow\n        <span class="token keyword">case</span> green\n        <span class="token keyword">case</span> <span class="token keyword">none</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">var</span> background<span class="token punctuation">:</span> colors<span class="token operator">?</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token builtin">CGRect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> frame<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> colors<span class="token punctuation">)</span><span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>background <span class="token operator">=</span> color\n        <span class="token keyword">switch</span> color <span class="token punctuation">{</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>red<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>red\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>blue<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>blue\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>yellow\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>green<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>green\n        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>black\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">touchesBegan</span><span class="token punctuation">(</span><span class="token number">_</span> touches<span class="token punctuation">:</span> <span class="token builtin">Set</span><span class="token operator">&lt;</span><span class="token builtin">UITouch</span><span class="token operator">></span><span class="token punctuation">,</span> with event<span class="token punctuation">:</span> <span class="token builtin">UIEvent</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"touched"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">required</span> <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>coder aDecoder<span class="token punctuation">:</span> <span class="token builtin">NSCoder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">"init(coder:) has not been implemented"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    \n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><code>ViewController.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>\n        <span class="token keyword">let</span> mergin <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">0.1</span>\n        \n        <span class="token comment">//Initialize Views</span>\n        <span class="token keyword">let</span> red <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> mergin<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> blue <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token punctuation">(</span>size<span class="token operator">+</span>mergin<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> yellow <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> mergin<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">+</span>size<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> green <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token punctuation">(</span>size<span class="token operator">+</span>mergin<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">+</span>size<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        \n        <span class="token comment">//Set Color</span>\n        red<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>red<span class="token punctuation">)</span>\n        blue<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>blue<span class="token punctuation">)</span>\n        yellow<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>\n        green<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>green<span class="token punctuation">)</span>\n        \n        <span class="token comment">//Add view</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>blue<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>yellow<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span>\n        <span class="token comment">// Do any additional setup after loading the view, typically from a nib.</span>\n    <span class="token punctuation">}</span>\n    \n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">didReceiveMemoryWarning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didReceiveMemoryWarning</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token comment">// Dispose of any resources that can be recreated.</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>各 View を tap で”touched”とログを吐きます。\n\n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-bottom: 1.0725rem;; max-width: 450px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 182.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMUlEQVRIx+2Wu2qEQBSGJynyBmm8gIgIIoJgAr6DsFV8gRRpLFJssBECbpE2fbotxMpb7BabND5BHkfmj7rZWzLZQGJAiAe+uXDg4wwcZoaIogCO4waDCAI/eqGAIAiQ5znKskSWZajr+oAkSRBFEdI0/ZTrqKoKvu/Ddd21MI5jUEq3fIxjuU2+aRp4ngfC83wvHCJ64abCPmYzQJaZLOQUFzJl8vhAd0JRFHdCywIIYXJLljhvlyzu538p7Npm3BWO/8j7fUhfLNBnwuSmuMRZccXEf11+IUQrBGFyjZN2PGUyp3d7QmESjltIn1rCVvAODbf7op1DumCyoiu2cJD78B8KDcMYVmia5siFkiRNbTMJfyK0bRuO4/waXdfXwmM/0u5V1DQNiqJAVdVvf7Bv7dJky/vc19wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="Early Printing Press" title="" src="/static/colorview-7bbf126f6d8599e622daf220fc19fe77-5ecc7.png" srcset="/static/colorview-7bbf126f6d8599e622daf220fc19fe77-39df4.png 188w,\n/static/colorview-7bbf126f6d8599e622daf220fc19fe77-e100e.png 375w,\n/static/colorview-7bbf126f6d8599e622daf220fc19fe77-5ecc7.png 450w" sizes="(max-width: 450px) 100vw, 450px">\n    </span>\n  </span>\n  </p>\n<h4>Delegateの準備</h4>\n<hr>\n<h5>処理を移譲する側の準備</h5>\n<p><code>タップされたViewが、ViewControllerに対して、自分がタップされたことを通知する</code><br>\nこれを Delegate を使って実装したいと思います。    </p>\n<ol>\n<li>Delegate の実態を宣言する</li>\n</ol>\n<p><code>ColorView.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n\nprotocol <span class="token builtin">ColorViewDlegate</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token builtin">ColorView</span><span class="token punctuation">.</span>colors<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ColorView</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">{</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre>\n      </div>\n<ol start="2">\n<li>Delegate を宣言する</li>\n</ol>\n<p><code>ColorView.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token keyword">class</span> <span class="token class-name">ColorView</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">{</span>\n\n    <span class="token keyword">var</span> background<span class="token punctuation">:</span> colors<span class="token operator">?</span>\n    <span class="token keyword">var</span> delegate<span class="token punctuation">:</span> <span class="token builtin">ColorViewDlegate</span><span class="token operator">?</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre>\n      </div>\n<ol start="3">\n<li>Delegate function を呼ぶ</li>\n</ol>\n<p><code>ColorView.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">touchesBegan</span><span class="token punctuation">(</span><span class="token number">_</span> touches<span class="token punctuation">:</span> <span class="token builtin">Set</span><span class="token operator">&lt;</span><span class="token builtin">UITouch</span><span class="token operator">></span><span class="token punctuation">,</span> with event<span class="token punctuation">:</span> <span class="token builtin">UIEvent</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"touched"</span><span class="token punctuation">)</span>\n        delegate<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>background<span class="token operator">!</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre>\n      </div>\n<p>上記 1~3 の手順で、通知する側(処理を移譲する側)の準備は終了です。</p>\n<h4>処理を移譲される側の準備</h4>\n<ol>\n<li>Delegate を使うことを定義</li>\n</ol>\n<p><code>ViewController.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> <span class="token builtin">ColorViewDlegate</span><span class="token punctuation">{</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre>\n      </div>\n<ol start="2">\n<li>Delegate を受けた時の処理</li>\n</ol>\n<p><code>ViewController.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token keyword">func</span> <span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token builtin">ColorView</span><span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">switch</span> color <span class="token punctuation">{</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>red<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>blue<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"blue"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>green<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre>\n      </div>\n<ol start="3">\n<li>Delegate をの移譲先がこの Class であることの宣言</li>\n</ol>\n<p><code>ViewController.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code>    red<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n    blue<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n    yellow<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n    green<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n</code></pre>\n      </div>\n<p>ここで、“self”とできるのは、1.で Delegate を使うことを定義してあるからです。</p>\n<h4>コード全体</h4>\n<p><code>ColorView.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n\nprotocol <span class="token builtin">ColorViewDlegate</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token builtin">ColorView</span><span class="token punctuation">.</span>colors<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ColorView</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token punctuation">{</span>\n\n    <span class="token keyword">enum</span> colors<span class="token punctuation">{</span>\n        <span class="token keyword">case</span> red\n        <span class="token keyword">case</span> blue\n        <span class="token keyword">case</span> yellow\n        <span class="token keyword">case</span> green\n        <span class="token keyword">case</span> <span class="token keyword">none</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">var</span> background<span class="token punctuation">:</span> colors<span class="token operator">?</span>\n    <span class="token keyword">var</span> delegate<span class="token punctuation">:</span> <span class="token builtin">ColorViewDlegate</span><span class="token operator">?</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token builtin">CGRect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> frame<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> colors<span class="token punctuation">)</span><span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>background <span class="token operator">=</span> color\n        <span class="token keyword">switch</span> color <span class="token punctuation">{</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>red<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>red\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>blue<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>blue\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>yellow\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>green<span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>green\n        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">:</span>\n            <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>black\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">touchesBegan</span><span class="token punctuation">(</span><span class="token number">_</span> touches<span class="token punctuation">:</span> <span class="token builtin">Set</span><span class="token operator">&lt;</span><span class="token builtin">UITouch</span><span class="token operator">></span><span class="token punctuation">,</span> with event<span class="token punctuation">:</span> <span class="token builtin">UIEvent</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"touched"</span><span class="token punctuation">)</span>\n        delegate<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>background<span class="token operator">!</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">required</span> <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>coder aDecoder<span class="token punctuation">:</span> <span class="token builtin">NSCoder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">"init(coder:) has not been implemented"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    \n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><code>ViewController.swift</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> <span class="token builtin">ColorViewDlegate</span> <span class="token punctuation">{</span>\n    \n    <span class="token comment">//MARK: ColorViewDelegate function</span>\n    <span class="token keyword">func</span> <span class="token function">tapped</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token builtin">ColorView</span><span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">switch</span> color <span class="token punctuation">{</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>red<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>blue<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"blue"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span>green<span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span>\n        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">:</span>\n            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    \n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>\n        <span class="token keyword">let</span> mergin <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">*</span><span class="token number">0.1</span>\n        \n        <span class="token comment">//Initialize Views</span>\n        <span class="token keyword">let</span> red <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> mergin<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> blue <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token punctuation">(</span>size<span class="token operator">+</span>mergin<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> yellow <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> mergin<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">+</span>size<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> green <span class="token operator">=</span> <span class="token function">ColorView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token punctuation">(</span>size<span class="token operator">+</span>mergin<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">+</span>size<span class="token punctuation">,</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        \n        <span class="token comment">//Set Color</span>\n        red<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>red<span class="token punctuation">)</span>\n        blue<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>blue<span class="token punctuation">)</span>\n        yellow<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>\n        green<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>green<span class="token punctuation">)</span>\n        \n        <span class="token comment">//Set delegate</span>\n        red<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n        blue<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n        yellow<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n        green<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>\n        \n        <span class="token comment">//Add view</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>blue<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>yellow<span class="token punctuation">)</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span>\n        <span class="token comment">// Do any additional setup after loading the view, typically from a nib.</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">didReceiveMemoryWarning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didReceiveMemoryWarning</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token comment">// Dispose of any resources that can be recreated.</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>これで、log が</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>touched\nred\ntouched\nblue\ntouched\nyellow\ntouched\n...</code></pre>\n      </div>\n<p>となれば成功です。</p>\n<h1>まとめ</h1>\n<p>全体の流れをもう一度確認すると。</p>\n<p>通知元のクラス(今回は ColorView)で、</p>\n<ul>\n<li><code>Delegateの実態</code></li>\n<li><code>Delegateの宣言</code></li>\n<li><code>Delegateの呼び出し</code><br>\nを準備する。　　</li>\n</ul>\n<p>通知先のクラス(今回は ViewController)で、</p>\n<ul>\n<li><code>Delegateを使うことを定義</code></li>\n<li><code>移譲されたDelegate funcionの処理</code></li>\n<li><code>Delegateを移譲する先がこのクラス(Viewcontroller)であることの宣言</code></li>\n</ul>\n<p>この二つの流れで、処理を移譲することができます。\nどうでしょうか。delegate は何かと使いやすいコールバックなので、ぜひ使っていきましょう。　　　</p>',
frontmatter:{layout:"post",title:"Swfit4でコールバック(２)",path:"/02042018/swift4_callback_02/",categories:["hoge"],date:"2018/02/04"}}},pathContext:{path:"/02042018/swift4_callback_02/"}}}});
//# sourceMappingURL=path---02042018-swift-4-callback-02-cc62de0a9fc19fa3ebdc.js.map